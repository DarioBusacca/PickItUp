create table User_profile (
	username varchar(30) primary key,
	password varchar(50),
	email varchar(50),
	gender varchar(10),
	nome varchar(30),
	cognome varchar(30),
	times timestamp default current_timestamp,
	birthday integer,
	picture text,
	points integer default 0,
	unique (email)
);

create table Friendship(
	profile_accept varchar(30) not null,
	profile_request varchar(30) not null,
	foreign key(profile_accept) 
		references user_profile(username),
	foreign key(profile_request) 
		references user_profile(username),
	primary key (profile_accept, profile_request)
);

CREATE TABLE messages (
  message_id  SERIAL PRIMARY KEY,
  username varchar(30) not null,
  room_id int NOT NULL,
  msg text not null,
  times timestamp  default current_timestamp,
  foreign key (username) references 
  user_profile(username),
	foreign key (room_id) references 
	challenge_room(room_id)
)


create table post (
	post_id SERIAL primary key,
	profile_id varchar(30),
	written_text text,
	media_location text,
	times timestamp default current_timestamp,
	foreign key(profile_id)
		references user_profile(username)
);
CREATE TABLE room_member (
  id serial  primary key,
  username varchar(30) NOT NULL,
  room_id int NOT NULL,
  times timestamp default current_timestamp,
  foreign key (username) references
  user_profile(username),
  foreign key (room_id) references
 challenge_room(room_id)
);

create table challenge_room (
	room_id SERIAL primary key,
	challenge_id int,
	description text,
	foreign key(challenge_id)
		references challenges(challenge_id),
	times timestamp default current_timestamp,
	creator varchar(30),
	foreign key(creator) 
		references user_profile(username)
);
create table challenges(
	challenge_id SERIAL primary key,
	creator varchar(30),
	times timestamp default current_timestamp,
	luogo text,
	nPartecipanti integer,
	foreign key(creator)
		references user_profile(username)
	points integer default 10
);

create table partecipa(
	profile_id varchar(30),
	challenge_id SERIAL,
	foreign key(profile_id)
		references user_profile(username),
	foreign key(challenge_id)
		references challenges(challenge_id),
	primary key(profile_id, challenge_id)
);

create table aziende(
	codice varchar(20) primary key,
	nome varchar(20),
	logo text,
	sito text
);

create table premi(
	premio_id SERIAL primary key,
	prezzo integer,
	azienda_id varchar(20),
	premio text,
	quantita integer,
	foreign key(azienda_id)
		references aziende(codice)
);

create table premio_acquisito(
	profile_id varchar(30),
	premio varchar(10),
	foreign key(profile_id)
		references user_profile(username),
	foreign key(premio)
		references premi(premio_id),
	primary key(profile_id, premio)
);

/*I cosi s' fanu giusti na vota e basta!


insert into aziende values ('1', 'ennel', 'example.com'), ('2', 'azienda', 'example.com');